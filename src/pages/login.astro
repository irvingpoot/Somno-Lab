---
import Layout from '../layouts/Layout.astro';
import { SignedIn, SignIn } from '@clerk/astro/components';

const redirectUrl = Astro.url.searchParams.get("redirect_url") || "/citas";
---

<Layout title="Acceso - Laboratorio del Sueño" showFooter={false}>
    <div class="flex min-h-screen bg-gray-50">
        
        <div class="hidden lg:flex lg:w-1/2 relative bg-[url(https://images.unsplash.com/photo-1556750539-dc6305f4f248?q=80&w=675&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D)] bg-cover bg-somno-light bg-blend-luminosity overflow-hidden flex-col justify-between text-white p-12">
            
            <div class="relative z-10 mt-10">
                <h1 class="text-8xl font-bold tracking-tight mb-4">SomnoLab</h1>
                <p class="text-lg text-blue-50 font-light max-w-md leading-relaxed">
                    Plataforma de monitoreo y registro de pacientes de SomnoLab.
                </p>
            </div>

            <div class="absolute bottom-0 left-0 right-0 w-full transform scale-[1.8] origin-bottom-left pointer-events-none">
                <svg viewBox="0 0 1440 320" class="w-full h-auto text-somno-dark/70 fill-current">
                    <path d="M0,224L60,213.3C120,203,240,181,360,181.3C480,181,600,203,720,224C840,245,960,267,1080,261.3C1200,256,1320,224,1380,208L1440,192L1440,320L1380,320C1320,320,1200,320,1080,320C960,320,840,320,720,320C600,320,480,320,360,320C240,320,120,320,60,320L0,320Z"></path>
                </svg>
                <svg viewBox="0 0 1440 320" class="absolute bottom-0 w-full h-auto text-somno-light/70 fill-current" style="transform: scaleY(1.1) translateY(10%); transform-origin: bottom;">
                    <path d="M0,96L80,122.7C160,149,320,203,480,208C640,213,800,171,960,160C1120,149,1280,171,1360,181.3L1440,192L1440,320L1360,320C1280,320,1120,320,960,320C800,320,640,320,480,320C320,320,160,320,80,320L0,320Z"></path>
                </svg>
            </div>
        </div>

        <main class="w-full lg:w-1/2 flex flex-col items-center justify-center p-8 relative">
            <div class="lg:hidden mb-8 text-center">
                <h1 class="text-4xl font-bold text-somno-dark">SomnoLab</h1>
            </div>

            <div class="w-full max-w-md space-y-8">
                <div class="text-center">
                    <h2 class="mt-6 text-3xl font-bold tracking-tight text-gray-900">Bienvenido de nuevo</h2>
                </div>

                <div class="flex justify-center mt-8 login-container">
                    <SignIn 
                        forceRedirectUrl={redirectUrl}
                    />
                    <SignedIn>
                        <h1 class="z-100 text-2xl bg-amber-400">Holap</h1>
                    </SignedIn>
                </div>
                
                <div class="mt-10 text-center">
                    <p class="text-xs text-gray-400">
                        &copy; {new Date().getFullYear()} SomnoLab. Todos los derechos reservados.
                    </p>
                </div>
            </div>

            <SignedIn>
                <div class="absolute inset-0 z-50 flex flex-col items-center justify-center bg-white/90 backdrop-blur-sm transition-all duration-300">
                    
                    <div class="relative flex h-20 w-20 items-center justify-center">
                        <div class="absolute h-full w-full rounded-full border-4 border-gray-100 opacity-50"></div>
                        <div class="absolute h-full w-full animate-spin rounded-full border-4 border-transparent border-t-somno-primary border-r-somno-primary"></div>
                    </div>

                    <h3 class="mt-6 text-xl font-semibold text-somno-dark animate-pulse">
                        Iniciando sesión...
                    </h3>
                    <p class="mt-2 text-sm text-gray-500">
                        Te estamos redirigiendo al panel.
                    </p>
                </div>
            </SignedIn>

        </main>
    </div>
</Layout>